<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="theme-color" content="#0f172a"><title>StreamHub</title><style>:root{--bg:#121212;--card:#1e1e1e;--muted:#b0b0b0;--accent:#1db954;--btn-text:#e6eef8}*{box-sizing:border-box}html,body{height:100%;margin:0;background:var(--bg);color:#e6eef8;font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}#app{padding:env(safe-area-inset-top)12px 12px env(safe-area-inset-bottom);min-height:100vh;display:flex;flex-direction:column}header{display:flex;align-items:center;gap:12px;padding:6px 4px}h1{font-size:18px;margin:0}main{flex:1;display:block}nav{position:fixed;left:0;right:0;bottom:env(safe-area-inset-bottom);display:flex;justify-content:space-around;padding:8px;background:rgba(30,30,30,0.9);backdrop-filter:blur(6px)}button.tab{background:transparent;border:0;color:var(--muted);font-size:12px;display:flex;flex-direction:column;align-items:center;gap:4px;padding:6px 8px;border-radius:10px}button.tab.active{color:var(--accent)}.page{display:none;padding-bottom:72px}.page.active{display:block}input,textarea,select{background:var(--card);border:0;color:inherit;font:inherit;border-radius:8px;padding:8px}form.search{display:flex;gap:8px;margin:8px 0}input.q{flex:1;background:var(--card);padding-left:12px}button.icon{background:var(--card);border-radius:10px;padding:8px;border:0;color:var(--btn-text)}section.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:10px}article.card{background:var(--card);padding:8px;border-radius:12px;display:flex;flex-direction:column;gap:8px}article.card img{width:100%;height:200px;object-fit:cover;border-radius:8px}small{color:var(--muted)}.hlist{display:flex;gap:8px;overflow:auto;padding-bottom:8px}.hitem{min-width:120px;background:var(--card);padding:8px;border-radius:10px}footer.help{padding:12px;text-align:center;color:var(--muted);font-size:12px}</style></head><body><div id="app"><header><h1>StreamHub</h1><div style="margin-left:auto"><button id="openSettings" class="icon">‚öôÔ∏è</button></div></header><main><section id="movies" class="page active"><form class="search" onsubmit="return sumb('movie')"><input id="qmovie" class="q" placeholder="Search movies" autocomplete="off"><button class="icon" type="submit">üîç</button></form><div id="movielist" class="grid"></div></section><section id="tv" class="page"><form class="search" onsubmit="return sumb('tv')"><input id="qtv" class="q" placeholder="Search TV shows" autocomplete="off"><button class="icon" type="submit">üîç</button></form><div id="tvlist" class="grid"></div></section><section id="fav" class="page"><h3>Your recently watched</h3><div id="recent" class="hlist"></div><h3 style="margin-top:12px">Favourites</h3><div id="favs" class="hlist"></div></section><section id="settings" class="page"><div style="display:flex;gap:8px;align-items:center"><label style="font-size:13px">TMDB API</label><input id="tmdbkey" placeholder="TMDB API key"></div><div style="margin-top:10px"><label style="font-size:13px">Plugins (JSON array)</label><textarea id="plugins" style="width:100%;height:140px;background:var(--card);color:var(--btn-text)"></textarea></div><div style="display:flex;gap:8px;margin-top:10px"><button id="save" class="icon" style="color:var(--btn-text)">Save</button><button id="import" class="icon" style="color:var(--btn-text)">Import</button></div><div style="margin-top:12px;color:var(--muted);font-size:13px">Note: add plugin JSON array. Plugins are used to build embed links.</div></section></main><nav><button class="tab active" data-tab="movies">üé¨<span>Movies</span></button><button class="tab" data-tab="tv">üì∫<span>TV</span></button><button class="tab" data-tab="fav">‚≠ê<span>Favourites</span></button><button class="tab" data-tab="settings">‚öôÔ∏è<span>Settings</span></button></nav><div id="modal" style="position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.6);z-index:50"><div style="width:94%;max-width:900px;background:var(--card);border-radius:12px;padding:10px;position:relative"><button id="closeModal" style="position:absolute;right:8px;top:8px" class="icon">‚úñ</button><div id="player"></div></div></div><footer class="help">Add your TMDB API key in Settings. Plugins allow custom embed URLs.</footer></div><script>const $=(s)=>document.querySelector(s),qs=(s)=>document.querySelectorAll(s);let tm='',plugins=[];const el=(id)=>document.getElementById(id);function t(n){qs('.tab').forEach(b=>b.classList.remove('active'));qs('.page').forEach(p=>p.classList.remove('active'));document.querySelector(`[data-tab="${n}"]`).classList.add('active');el(n).classList.add('active')}qs('.tab').forEach(b=>b.addEventListener('click',e=>t(b.dataset.tab)));el('openSettings').addEventListener('click',()=>t('settings'));el('save').addEventListener('click',saveSettings);el('import').addEventListener('click',()=>{const j=prompt('Paste plugin JSON array');if(!j) return;try{plugins=JSON.parse(j);el('plugins').value=JSON.stringify(plugins);saveSettings()}catch(e){alert('invalid')} });function load(){tm=localStorage.getItem('tmdb')||'';plugins=JSON.parse(localStorage.getItem('plugins')||'[]');el('tmdbkey').value=tm;el('plugins').value=plugins.length?JSON.stringify(plugins):'';fetchMovies();fetchTV();renderFavs()}function saveSettings(){tm=el('tmdbkey').value.trim();localStorage.setItem('tmdb',tm);try{const p=el('plugins').value.trim();plugins=p?JSON.parse(p):[];localStorage.setItem('plugins',JSON.stringify(plugins));alert('saved')}catch(e){alert('invalid json')}}el('tmdbkey').addEventListener('input',()=>{tm=el('tmdbkey').value.trim();localStorage.setItem('tmdb',tm)});el('plugins').addEventListener('input',()=>{try{plugins=JSON.parse(el('plugins').value.trim());localStorage.setItem('plugins',JSON.stringify(plugins))}catch(e){}});async function api(path){if(!tm) return Promise.resolve({results:[]});const u=`https://api.themoviedb.org/3${path}&api_key=${tm}&language=en-US`;try{const r=await fetch(u);if(!r.ok) return {results:[]};return await r.json()}catch(e){return {results:[]}}}function card(it,type){const img=it.poster_path?`https://image.tmdb.org/t/p/w500${it.poster_path}`:'data:image/svg+xml,%3Csvg xmlns%3D"http://www.w3.org/2000/svg" width%3D"400" height%3D"600"%3E%3Crect width%3D"100%25" height%3D"100%25" fill%3D"%231e1e1e"/%3E%3Ctext x%3D"50%25" y%3D"50%25" font-size%3D"20" fill%3D"%23b0b0b0" text-anchor%3D"middle"%3ENo Image%3C/text%3E%3C/svg%3E';const a=document.createElement('article');a.className='card';a.innerHTML=`<img loading="lazy" src="${img}"><div style="display:flex;justify-content:space-between;align-items:center"><div style="flex:1"><strong style="display:block">${(it.title||it.name||'Untitled').slice(0,36)}</strong><small>${(it.release_date||it.first_air_date||'')}</small></div><div><button class="icon" data-id="${it.id}" data-type="${type}">‚ñ∂</button><button class="icon star" data-id="${it.id}" data-title="${(it.title||it.name||'Untitled').replace(/"/g,'')}">‚òÜ</button></div></div>`;const play=a.querySelector('button');play.addEventListener('click',()=>openPlayer(it.id,type));const star=a.querySelector('.star');star.addEventListener('click',()=>toggleFav(it.id,star.getAttribute('data-title')));return a}function renderList(elid,items,type){const cont=el(elid);cont.innerHTML='';items.forEach(i=>cont.appendChild(card(i,type)))}async function fetchMovies(){const res=await api('/movie/popular?');renderList('movielist',res.results||[],'movie')}async function fetchTV(){const res=await api('/tv/popular?');renderList('tvlist',res.results||[],'tv')}function sumb(type){const q=(type==='movie'?el('qmovie').value:el('qtv').value).trim();if(!q) return false;search(type,q);return false}async function search(type,q){const path=type==='movie'?`/search/movie?query=${encodeURIComponent(q)}`:`/search/tv?query=${encodeURIComponent(q)}`;const r=await api(path);renderList(type==='movie'?'movielist':'tvlist',r.results||[],type)}function toggleFav(id,title){let f=JSON.parse(localStorage.getItem('favs')||'[]');const idx=f.findIndex(a=>a.id==id);if(idx>-1){f.splice(idx,1)}else{f.unshift({id:id,title:title})}localStorage.setItem('favs',JSON.stringify(f));renderFavs()}function renderFavs(){const f=JSON.parse(localStorage.getItem('favs')||'[]');const c=el('favs');c.innerHTML='';f.slice(0,50).forEach(i=>{const d=document.createElement('div');d.className='hitem';d.innerHTML=`<strong>${i.title}</strong><div style="margin-top:8px"><button class="icon" data-id="${i.id}" data-type="movie">‚ñ∂</button></div>`;d.querySelector('button').addEventListener('click',()=>openPlayer(i.id,'movie'));c.appendChild(d)});const r=JSON.parse(localStorage.getItem('recent')||'[]');const rc=el('recent');rc.innerHTML='';r.slice(0,50).forEach(i=>{const d=document.createElement('div');d.className='hitem';d.innerHTML=`<strong>${i.title}</strong><div style="margin-top:8px"><button class="icon" data-id="${i.id}" data-type="${i.type}">‚ñ∂</button></div>`;d.querySelector('button').addEventListener('click',()=>openPlayer(i.id,i.type));rc.appendChild(d)})}function pushRecent(id,type,title){let r=JSON.parse(localStorage.getItem('recent')||'[]');r=r.filter(x=>!(x.id==id&&x.type==type));r.unshift({id, type, title});localStorage.setItem('recent',JSON.stringify(r.slice(0,50)));renderFavs()}function buildEmbed(id,type){if(!plugins||!plugins.length) return null;for(const p of plugins){if(p.embed_url||p.url){const tpl=p.embed_url||p.url;if(type==='movie'){if(tpl.includes('{i}')) return tpl.replace('{i}',id).replace('{id}',id)}else{if(p.tv_embed_url||p.tv_url){const t= p.tv_embed_url||p.tv_url;return t.replace('{i}',id).replace('{id}',id).replace('{s}',1).replace('{e}',1).replace('{season}','1').replace('{episode}','1')}}} }return null}const modal=el('modal');el('closeModal').addEventListener('click',closeModal);function openPlayer(id,type){const title=(type==='movie'?'Movie':'TV')+' '+id;pushRecent(id,type,title);const src=buildEmbed(id,type);const player=el('player');if(!src){player.innerHTML=`<div style="padding:20px;color:var(--muted)">No plugin available to play this item. Add plugins in Settings.</div>`}else{player.innerHTML=`<iframe src="${src}" style="width:100%;height:60vh;border:0;border-radius:8px"></iframe>`}modal.style.display='flex'}function closeModal(){modal.style.display='none';el('player').innerHTML=''}load();</script></body></html>
